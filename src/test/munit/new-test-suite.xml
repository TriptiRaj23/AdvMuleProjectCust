<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:munit="http://www.mulesoft.org/schema/mule/munit" xmlns:munit-tools="http://www.mulesoft.org/schema/mule/munit-tools"
	xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xsi:schemaLocation="
		http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
		http://www.mulesoft.org/schema/mule/munit http://www.mulesoft.org/schema/mule/munit/current/mule-munit.xsd
		http://www.mulesoft.org/schema/mule/munit-tools  http://www.mulesoft.org/schema/mule/munit-tools/current/mule-munit-tools.xsd">
	<munit:config name="new-test-suite.xml" />
	<munit:test name="new-test-suite-abc-customer-getCustomerTest" doc:id="7346e788-e1be-499f-883a-78c9a694b3b9" description="Test">

    <munit:behavior>
        <munit-tools:mock-when processor="db:select">
            <munit-tools:with-attributes>
                <munit-tools:with-attribute
                    attributeName="doc:name"
                    whereValue="Select"/>
            </munit-tools:with-attributes>

            <munit-tools:then-return>
                <munit-tools:payload
                    
                    value='#[[
                      {
                        "FirstName": "Ramya",
                        "LastName": "Raman",
                        "Phone": "8877661122",
                        "Email": "ramya@gmail.com"
                      },
                      {
                        "FirstName": "Tara",
                        "LastName": "Sutaria",
                        "Phone": "8877661188",
                        "Email": "tara@gmail.com"
                      },
                      {
                        "FirstName": "Jeewan",
                        "LastName": "Som",
                        "Phone": "8877661100",
                        "Email": "jeewan@gmail.com"
                      }
                    ]]'/>
            </munit-tools:then-return>
        </munit-tools:mock-when>

    </munit:behavior>

    <munit:execution>
        <flow-ref name="abc-customer-getCustomer"/>
    </munit:execution>

    <munit:validation>

        <logger message="#[payload]"/>

        <!-- NOW THIS WILL PASS -->
        <munit-tools:assert-equals
            actual="#[sizeOf(payload) as String]"
     			expected="3"/>

        <munit-tools:assert-equals
            actual="#[payload[-1].Email]"
            expected="jeewan@gmail.com"/>

    </munit:validation>


	</munit:test>
	<munit:test name="new-test-suite-abc-customer-createCustomerTest" doc:id="8fd30e96-74db-49b0-ace2-e0563e0bb15f" description="Test">

 <munit:behavior>
    <set-payload
      mimeType="application/json"
      value='#["
      {
        \"FirstName\": \"Jeewan\",
        \"LastName\": \"Som\",
        \"Phone\": \"8877661100\",
        \"Email\": \"jeewan@gmail.com\"
      }
      "]'/>
  </munit:behavior>

  <munit:execution>
    <flow-ref name="abc-customer-createCustomer"/>
  </munit:execution>

  <munit:validation>
    <logger message="#[payload]"/>
    <munit-tools:assert-equals
      actual="#[payload.message]"
      expected="Data has been created."/>
  </munit:validation>
  </munit:test>
	<munit:test name="new-test-suite-abc-customer-deleteCustomerTest" doc:id="fa47216e-3bee-45e6-9b44-446f87908292" description="Test">
  <munit:behavior>
    <set-payload
      mimeType="application/json"
      value='#["{
        \"FirstName\": \"Radha\",
        \"LastName\": \"Rani\",
        \"Phone\": \"8811223344\",
        \"Email\": \"radha123@gmail.com\"
      }"]'/>
  </munit:behavior>

  <munit:execution>
    <flow-ref name="abc-customer-deleteCustomer"/>
  </munit:execution>

  <munit:validation>
    <logger message="#[payload]"/>
    <munit-tools:assert-equals
      actual="#[payload.message]"
      expected="Data has been deleted."/>
  </munit:validation>
	</munit:test>
	<munit:test name="new-test-suite-abc-customer-updateCustomerTest" doc:id="2fd9b487-5972-40f0-b271-d179045cafe2" description="Test">
  <munit:behavior>
    <set-payload
      mimeType="application/json"
      value='#["{
        \"FirstName\" : \"Satyam\",
        \"LastName\" : \"Kesarwani\",
        \"Phone\" : \"9090807766\",
        \"Email\" : \"mahesh@gmail.com\"
      }"]'/>
  </munit:behavior>

  <munit:execution>
    <flow-ref name="abc-customer-updateCustomer"/>
  </munit:execution>

  <munit:validation>
    <logger message="#[payload]"/>
    <munit-tools:assert-equals
      actual="#[payload.message]"
      expected="Data has been updated."/>
  </munit:validation>
	</munit:test>


</mule>
